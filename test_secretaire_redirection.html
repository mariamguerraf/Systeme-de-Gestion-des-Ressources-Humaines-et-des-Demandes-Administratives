<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Redirection Secr√©taire</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Redirection Secr√©taire</h1>
        <p>Ce test v√©rifie que les utilisateurs secr√©taires sont correctement redirig√©s vers leur dashboard.</p>

        <!-- Section de test de connexion -->
        <div class="test-section info">
            <h3>üîê Test de Connexion API</h3>
            <p>Utilisateur de test : <strong>secretaire@univ.ma</strong></p>
            <button onclick="testLogin()">Tester la Connexion</button>
            <div id="loginResult" class="status" style="display: none;"></div>
        </div>

        <!-- Section de test des routes -->
        <div class="test-section info">
            <h3>üõ£Ô∏è Test des Routes Frontend</h3>
            <p>V√©rification des routes secr√©taire disponibles :</p>
            <button onclick="testRoute('/secretaire/dashboard')">Tester Dashboard</button>
            <button onclick="testRoute('/secretaire/users')">Tester Utilisateurs</button>
            <button onclick="testRoute('/secretaire/demandes')">Tester Demandes</button>
            <div id="routeResult" class="status" style="display: none;"></div>
        </div>

        <!-- Section d'information sur les corrections -->
        <div class="test-section success">
            <h3>‚úÖ Corrections Appliqu√©es</h3>
            <ul>
                <li><strong>DashboardRouter.tsx</strong> : Redirection secr√©taire vers <code>/secretaire/dashboard</code></li>
                <li><strong>App.tsx</strong> : Ajout des routes avec pr√©fixe <code>/secretaire/</code></li>
                <li><strong>ProtectedRoute.tsx</strong> : Mise √† jour de la redirection par d√©faut</li>
                <li><strong>start_projet.ps1</strong> : Utilisation de <code>main_minimal.py</code> avec authentification</li>
            </ul>
        </div>

        <!-- Instructions pour tester manuellement -->
        <div class="test-section info">
            <h3>üìã Test Manuel</h3>
            <ol>
                <li>Lancez les services : <code>.\start_projet.ps1</code></li>
                <li>Ouvrez l'application : <a href="http://localhost:8081" target="_blank">http://localhost:8081</a></li>
                <li>Connectez-vous avec :
                    <ul>
                        <li><strong>Email :</strong> secretaire@univ.ma</li>
                        <li><strong>Mot de passe :</strong> secretaire2024</li>
                    </ul>
                </li>
                <li>V√©rifiez que vous √™tes redirig√© vers <code>/secretaire/dashboard</code></li>
                <li>Testez la navigation entre les pages secr√©taire</li>
            </ol>
        </div>

        <!-- Comptes de test disponibles -->
        <div class="test-section">
            <h3>üë• Comptes de Test Disponibles</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="background-color: #f8f9fa;">
                    <th style="border: 1px solid #ddd; padding: 8px;">R√¥le</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Email</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Mot de passe</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Redirection</th>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">Admin</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">admin@univ.ma</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">admin2024</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">/cadmin/dashboard</td>
                </tr>
                <tr style="background-color: #fff3cd;">
                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>Secr√©taire</strong></td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>secretaire@univ.ma</strong></td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>secretaire2024</strong></td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>/secretaire/dashboard</strong></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">Enseignant</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">enseignant@univ.ma</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">enseignant2024</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">/enseignant/profil</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">Fonctionnaire</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">fonctionnaire@univ.ma</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">fonctionnaire2024</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">/fonctionnaire/profil</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‚è≥ Test de connexion en cours...';
            resultDiv.className = 'status info';

            try {
                const response = await fetch('http://localhost:8000/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'username=secretaire@univ.ma&password=secretaire2024'
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Connexion r√©ussie!</strong><br>
                        Token re√ßu: ${data.access_token ? 'Oui' : 'Non'}<br>
                        Type: ${data.token_type || 'N/A'}
                    `;
                    resultDiv.className = 'status success';

                    // Test de r√©cup√©ration des informations utilisateur
                    try {
                        const userResponse = await fetch('http://localhost:8000/auth/me', {
                            headers: {
                                'Authorization': `Bearer ${data.access_token}`
                            }
                        });
                        
                        if (userResponse.ok) {
                            const userData = await userResponse.json();
                            resultDiv.innerHTML += `<br><strong>Donn√©es utilisateur:</strong><br>
                                Email: ${userData.email}<br>
                                R√¥le: ${userData.role}<br>
                                ID: ${userData.id}`;
                        }
                    } catch (userError) {
                        resultDiv.innerHTML += `<br><em>Erreur lors de la r√©cup√©ration des donn√©es utilisateur: ${userError.message}</em>`;
                    }
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `<strong>‚ùå Erreur de connexion</strong><br>Status: ${response.status}<br>R√©ponse: ${errorText}`;
                    resultDiv.className = 'status error';
                }
            } catch (error) {
                resultDiv.innerHTML = `<strong>‚ùå Erreur de r√©seau</strong><br>${error.message}<br><em>V√©rifiez que le backend est d√©marr√© sur le port 8000</em>`;
                resultDiv.className = 'status error';
            }
        }

        async function testRoute(route) {
            const resultDiv = document.getElementById('routeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `‚è≥ Test de la route ${route}...`;
            resultDiv.className = 'status info';

            try {
                // Test si la route est accessible
                const url = `http://localhost:8081${route}`;
                window.open(url, '_blank');
                
                resultDiv.innerHTML = `<strong>üîó Route test√©e</strong><br>URL ouverte: ${url}<br><em>V√©rifiez que la page se charge correctement dans le nouvel onglet</em>`;
                resultDiv.className = 'status success';
            } catch (error) {
                resultDiv.innerHTML = `<strong>‚ùå Erreur</strong><br>${error.message}`;
                resultDiv.className = 'status error';
            }
        }

        // Afficher les informations de statut au chargement
        window.onload = function() {
            console.log('üß™ Page de test de redirection secr√©taire charg√©e');
            console.log('üìã Instructions:');
            console.log('1. Lancez les services avec .\\start_projet.ps1');
            console.log('2. Testez la connexion API');
            console.log('3. Testez les routes frontend');
            console.log('4. Effectuez un test manuel complet');
        };
    </script>
</body>
</html>
